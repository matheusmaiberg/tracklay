# ============================================================
# TRACKLAY - ENVIRONMENT VARIABLES
# ============================================================
# Copy this file to .env and fill in your values
# For production, set these in Cloudflare Dashboard:
# Workers > Your Worker > Settings > Variables

# ============================================================
# REQUIRED: OBFUSCATION (Anti-Ad-Blocker)
# ============================================================
# UUID-based endpoint obfuscation - CRITICAL for bypassing ad-blockers
# Generate UUIDs: node -e "console.log(require('crypto').randomUUID())"
#
# WITHOUT THESE: Ad-blockers will detect /cdn/gtm.js, /cdn/fbevents.js
# WITH THESE: Ad-blockers can't detect /cdn/g/{UUID}-gtm.js

# Facebook Pixel endpoint UUID (REQUIRED for obfuscation)
# Creates obfuscated paths:
#   - /cdn/f/{UUID}-script.js → Facebook script
#   - /cdn/f/{UUID}.js → Facebook tracking endpoint
FACEBOOK_ENDPOINT_ID=a8f3c2e1-4b9d-4f5a-8c3e-2d1f9b4a7c6e

# Google Analytics/GTM endpoint UUID (REQUIRED for obfuscation)
# Creates obfuscated paths:
#   - /cdn/g/{UUID}-gtm.js → GTM script
#   - /cdn/g/{UUID}-tag.js → GTag script
#   - /cdn/g/{UUID}.js → GA4 tracking endpoint
GOOGLE_ENDPOINT_ID=b7e4d3f2-5c0e-4a6b-9d4f-3e2a0c5b8d7f

# UUID Secret for hash generation (RECOMMENDED)
# Generate: node -e "console.log(require('crypto').randomUUID())"
# Or set via: wrangler secret put UUID_SECRET
UUID_SECRET=your-secret-uuid-here

# ============================================================
# REQUIRED: CORS ORIGINS
# ============================================================
# Your Shopify store domains (comma-separated)
# Include BOTH myshopify.com and custom domain
ALLOWED_ORIGINS=https://yourstore.myshopify.com,https://www.yourstore.com

# ============================================================
# OPTIONAL: GTM SERVER-SIDE / PROXY CONFIGURATION
# ============================================================
# Configure where GA4 tracking requests should be proxied to
#
# ⚠️ THREE OPTIONS:
#
# 1️⃣ CLIENT-SIDE ONLY (No proxy for GA4 tracking)
#    Leave empty. GA4 goes directly to www.google-analytics.com
#    GTM_SERVER_URL=
#
# 2️⃣ PROXY VIA CLOUDFLARE WORKER (Recommended for ad-blocker bypass)
#    Set to your worker domain. Worker proxies /g/collect to Google
#    This enables first-party GA4 tracking through your domain
GTM_SERVER_URL=https://cdn.yourstore.com
#
#    Result:
#      GA4 → cdn.yourstore.com/g/collect → Worker → www.google-analytics.com/g/collect
#
# 3️⃣ REAL GTM SERVER-SIDE CONTAINER (Advanced - requires Google Cloud)
#    Set to your GTM Server container URL (Google Cloud Run)
#    GTM_SERVER_URL=https://your-container-id.run.app
#
#    Result:
#      GA4 → cdn.yourstore.com/g/collect → Worker → your-container.run.app/g/collect
#
# When set, creates these proxy endpoints:
#   /g/collect → {GTM_SERVER_URL}/g/collect (GA4 tracking)
#   /j/collect → {GTM_SERVER_URL}/j/collect (JavaScript errors)
#   /cdn/g/{UUID}.js → {GTM_SERVER_URL}/g/collect (obfuscated endpoint)

# ============================================================
# OPTIONAL: DEBUG CONFIGURATION
# ============================================================
# Enable debug headers for development/staging
# When enabled, adds headers like X-Script-Key, X-Script-Hash, X-Cache-Status
# and exposes detailed metrics in /health endpoint
#
# ⚠️ IMPORTANT: Set to false in production to maintain obfuscation
#
# Debug headers expose internal state and can be used for ad-blocker
# fingerprinting. Only enable for local development or staging environments.
#
# Headers added when DEBUG_HEADERS=true:
# - X-Script-Key: Which script is served (fbevents/gtm/gtag)
# - X-Script-Hash: SHA-256 hash of script content
# - X-Cache-Updated/Refreshed: Cache update timestamps
# - X-Cache-Type: Cache state (stale/fresh)
# - X-Cache-Status: Cache hit/miss status
# - Health endpoint: UUID, metrics, Cloudflare info
#
# Security impact:
# - Production (false): Detection rate <10%, maximum obfuscation
# - Development (true): Detection rate 50%+, fingerprinting possible
#
# See: docs/OBFUSCATION.md (lines 114-132, 540-546)
#
# Default: false (production-safe)
# DEBUG_HEADERS=false

# For development/staging (optional):
# DEBUG_HEADERS=true

# ============================================================
# OPTIONAL: ADVANCED SETTINGS
# ============================================================
# Only customize these if you need non-default behavior

# Rate Limiting (default: 100 requests per minute)
# RATE_LIMIT_REQUESTS=100
# RATE_LIMIT_WINDOW=60000

# Fetch timeout in milliseconds (default: 10s)
# FETCH_TIMEOUT=10000

# Cache TTL in seconds for proxied scripts (default: 1 hour)
# CACHE_TTL=3600

# Maximum request body size in bytes (default: 1MB)
# MAX_REQUEST_SIZE=1048576

# UUID salt rotation interval in milliseconds (default: 7 days)
# UUID_SALT_ROTATION=604800000

# Log level: debug, info, warn, error (default: info)
# LOG_LEVEL=info

# ============================================================
# FOR CLOUDFLARE DEPLOYMENT (wrangler CLI)
# ============================================================
# These are used by wrangler for deployment
# Not passed to the worker itself

# Your Cloudflare Account ID (get from: wrangler whoami)
# CLOUDFLARE_ACCOUNT_ID=your-account-id

# Your Cloudflare API Token (create at: Cloudflare Dashboard > My Profile > API Tokens)
# CLOUDFLARE_API_TOKEN=your-api-token
