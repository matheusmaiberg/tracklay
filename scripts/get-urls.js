#!/usr/bin/env node
// ============================================================
// GET OBFUSCATED URLS - Helper Script
// ============================================================
// This script displays the obfuscated tracking URLs based on
// your current configuration (environment variables or auto-generated)

import { CONFIG, initConfig } from '../src/config/index.js';

// Parse command line arguments
const args = process.argv.slice(2);
const domain = args[0] || 'https://yourstore.com';

console.log('\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—');
console.log('â•‘  TRACKLAY - OBFUSCATED TRACKING URLS                       â•‘');
console.log('â•‘  VERSION 3.0.0 - LEGACY ROUTES REMOVED                     â•‘');
console.log('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

console.log('âš ï¸  BREAKING CHANGE (v3.0.0)\n');
console.log('   All legacy detectable routes have been REMOVED:');
console.log('   âŒ /cdn/fbevents.js, /cdn/gtm.js, /cdn/gtag.js');
console.log('   âŒ /tr, /g/collect, /j/collect');
console.log('   âŒ /assets/*, /static/* variants\n');
console.log('   âœ… Only obfuscated UUID-based routes remain');
console.log('   ğŸ“š Migration guide: docs/MIGRATION-V3.md\n');

// Initialize config (reads from environment variables if set)
initConfig(process.env);

console.log(`ğŸ“ Domain: ${domain}\n`);

// Facebook Pixel URLs
console.log('ğŸ”µ FACEBOOK PIXEL (Meta Pixel)\n');
console.log('   Obfuscated Path (script + endpoint share same path):');
console.log(`   ${domain}/cdn/f/${CONFIG.ENDPOINTS_FACEBOOK}\n`);
console.log('   â„¹ï¸  Same path for both script (GET) and endpoint (POST)\n');

// Google Analytics URLs
console.log('ğŸ”´ GOOGLE ANALYTICS / TAG MANAGER\n');

if (CONFIG.GTM_SERVER_URL) {
  console.log(`   GTM Server URL: ${CONFIG.GTM_SERVER_URL}\n`);

  console.log('   Obfuscated Path (script + endpoint share same path):');
  console.log(`   ${domain}/cdn/g/${CONFIG.ENDPOINTS_GOOGLE}\n`);

  console.log('   Usage Examples:');
  console.log(`   â€¢ GTM Script:  ${domain}/cdn/g/${CONFIG.ENDPOINTS_GOOGLE}?id=GTM-XXXXX`);
  console.log(`   â€¢ GA4 Script:  ${domain}/cdn/g/${CONFIG.ENDPOINTS_GOOGLE}?id=G-XXXXX`);
  console.log(`   â€¢ With Alias:  ${domain}/cdn/g/${CONFIG.ENDPOINTS_GOOGLE}?c=abc123\n`);
  console.log('   â„¹ï¸  Same path for both script (GET) and endpoint (GET with v=2/tid=/_p=)\n');
} else {
  console.log('   âš ï¸  GTM_SERVER_URL not configured');
  console.log('   Set GTM_SERVER_URL to enable Google Analytics endpoints\n');
}

// Configuration info
console.log('âš™ï¸  CONFIGURATION\n');
console.log(`   Facebook Endpoint ID: ${CONFIG.ENDPOINTS_FACEBOOK}`);
console.log(`   Google Endpoint ID:   ${CONFIG.ENDPOINTS_GOOGLE}\n`);

if (CONFIG.ENDPOINTS_FACEBOOK.includes('-')) {
  const isAutoGenerated = CONFIG.ENDPOINTS_FACEBOOK.length === 36;
  if (isAutoGenerated) {
    console.log('   â„¹ï¸  Using auto-generated UUIDs');
    console.log('   ğŸ’¡ TIP: Set custom UUIDs via environment variables for production\n');
  } else {
    console.log('   âœ… Using custom UUIDs\n');
  }
}

// Instructions
console.log('ğŸ“– NEXT STEPS\n');
console.log('   1. Copy the obfuscated URLs above');
console.log('   2. Update your Shopify theme with these URLs');
console.log('   3. Test that scripts load and tracking works');
console.log('   4. Monitor Events Manager (Facebook) and Real-Time (Google)\n');

console.log('   ğŸ“š Full migration guide: docs/OBFUSCATION.md');
console.log('   ğŸ”§ Environment setup:    .env.example\n');

console.log('ğŸ’¡ TIPS\n');
console.log('   â€¢ Use obfuscated URLs for maximum ad-blocker bypass');
console.log('   â€¢ Rotate UUIDs periodically for best results');
console.log('   â€¢ See docs/OBFUSCATION.md for advanced strategies');
console.log('   â€¢ IMPORTANT: Legacy routes no longer supported (v3.0.0+)\n');

// Generate new UUIDs suggestion
console.log('ğŸ” GENERATE NEW UUIDS\n');
console.log('   Run this command to generate new random UUIDs:\n');
console.log('   node -e "console.log(require(\'crypto\').randomUUID())"\n');
console.log('   Then set them in Cloudflare Dashboard or .env file\n');

console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');
