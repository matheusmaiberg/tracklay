# ============================================================
# CLOUDFLARE WRANGLER CONFIGURATION
# ============================================================
# Cloudflare Workers deployment configuration
# Documentation: https://developers.cloudflare.com/workers/wrangler/configuration/

name = "tracklay"
main = "worker.js"
compatibility_date = "2026-01-26"

# Modern features enabled
compatibility_flags = ["nodejs_compat"]

# ============================================================
# WORKER SETTINGS
# ============================================================

# Worker limits (free tier: 100,000 requests/day)
# Upgrade to paid for unlimited requests
# https://developers.cloudflare.com/workers/platform/limits

# Account ID (get from: wrangler whoami)
# Replace with your account ID
# account_id = "your-account-id-here"

# ============================================================
# ROUTES (Custom Domain) - OPTIONAL
# ============================================================
# Configure routes to serve the worker from your domain
# Example: yourstore.com/cdn/* â†’ worker
#
# Option 1: Configure via Dashboard
#   Workers > Your Worker > Settings > Domains & Routes
#
# Option 2: Configure here (requires zone_id)
# Configure with your domain:
#
# [[routes]]
# pattern = "yourstore.com/cdn/*"
# zone_name = "yourstore.com"
#
# [[routes]]
# pattern = "www.yourstore.com/cdn/*"
# zone_name = "yourstore.com"

# ============================================================
# ENVIRONMENT VARIABLES
# ============================================================
# SECRETS Configuration:
#
# For local development:
#   Create .dev.vars file with:
#     OBFUSCATION_SECRET=your-secret-here
#     ENDPOINTS_API_TOKEN=your-token-here
#
# For production:
#   wrangler secret put OBFUSCATION_SECRET
#   wrangler secret put ENDPOINTS_API_TOKEN
#
# See .dev.vars.example for template
#
# Non-secret vars can be defined here:

[vars]
# ============= OPTIONAL CONFIGURATION =============
# All variables below are OPTIONAL and have smart defaults
# Configure only if you need to customize

# GTM Server-Side URL (optional, leave empty if not using)
GTM_SERVER_URL = "https://gtm.yourstore.com"

# CORS Origins (optional, auto-detected by default)
# Comma-separated list of allowed origins
ALLOWED_ORIGINS = "https://yourstore.com,https://www.yourstore.com,https://cdn.yourstore.com"

# Rate Limiting (optional)
RATE_LIMIT_REQUESTS = "100"
RATE_LIMIT_WINDOW = "60000"

# Fetch Timeout in milliseconds (optional)
FETCH_TIMEOUT = "10000"

# Cache TTL in seconds (optional)
CACHE_TTL = "3600"

# Max Request Size in bytes (optional)
MAX_REQUEST_SIZE = "1048576"

# Log Level (optional: debug, info, warn, error)
LOG_LEVEL = "info"

# ============= OBFUSCATION CONFIGURATION (Anti-Ad-Blocker) =============
# UUID-based endpoint obfuscation for maximum anti-detection
# These IDs are auto-generated if not provided, but setting custom UUIDs
# is HIGHLY RECOMMENDED for production deployments
#
# Generate UUIDs: node -e "console.log(require('crypto').randomUUID())"

# Facebook obfuscation UUID (creates: /cdn/f/{UUID}.js)
OBFUSCATION_FB_UUID = "a8f3c2e1-4b9d-4f5a-8c3e-2d1f9b4a7c6e"

# Google obfuscation UUID (creates: /cdn/g/{UUID}.js)
OBFUSCATION_GA_UUID = "b7e4d3f2-5c0e-4a6b-9d4f-3e2a0c5b8d7f"

# ============= UUID ROTATION & DEBUG =============
# UUID Rotation (false = fixed/recommended, true = rotation/advanced)
UUID_ROTATION_ENABLED = "false"

# Debug headers (false = production, true = development)
DEBUG_HEADERS_ENABLED = "false"

# Full script proxy (true = rewrite URLs in scripts, false = transport_url only)
FULL_SCRIPT_PROXY_ENABLED = "true"

# GTM Container aliases for query obfuscation (JSON string)
GTM_CONTAINER_ALIASES = "{}"

# UUID rotation interval in milliseconds (default: 7 days)
UUID_ROTATION_INTERVAL_MS = "604800000"

# See docs/OBFUSCATION.md for complete guide on anti-detection setup

# ============================================================
# CRON TRIGGERS
# ============================================================
# Scheduled events for automatic script cache updates
# Documentation: https://developers.cloudflare.com/workers/configuration/crons/

[triggers]
# Update script cache every 12 hours (00:00 and 12:00 UTC)
crons = ["0 */12 * * *"]

# ============================================================
# DEVELOPMENT
# ============================================================
# Local development settings
# Uncomment to enable development environment
# Deploy with: wrangler deploy --env development

# [env.development]
# name = "tracklay-dev"
# vars = { ENVIRONMENT = "development" }

# ============================================================
# STAGING
# ============================================================
# Staging environment
# Uncomment to enable staging environment
# Deploy with: wrangler deploy --env staging

# [env.staging]
# name = "tracklay-staging"
# vars = { ENVIRONMENT = "staging" }

# ============================================================
# BUILD
# ============================================================
# Build configuration for Workers bundling

[build]
command = ""

# ============================================================
# SMART PLACEMENT
# ============================================================
# Automatically run the Worker in the optimal location closest to backend services
# Documentation: https://developers.cloudflare.com/workers/configuration/smart-placement/

[placement]
mode = "smart"

# ============================================================
# OBSERVABILITY (Optional)
# ============================================================

[observability]
[observability.logs]
enabled = true
head_sampling_rate = 0.2
invocation_logs = true

[observability.traces]
enabled = true
head_sampling_rate = 0.05

# ============================================================
# NOTES
# ============================================================
# 1. Set OBFUSCATION_SECRET via wrangler secret:
#    wrangler secret put OBFUSCATION_SECRET
#
# 2. Configure routes via Dashboard or uncomment [[routes]] above
#
# 3. Update GTM_SERVER_URL in vars section above
#
# 4. Deploy with: wrangler deploy
#
# 5. For custom domain, add DNS CNAME:
#    Type: CNAME
#    Name: @ (or subdomain)
#    Content: your-worker.workers.dev
#    Proxy: Yes (orange cloud)
